{% extends 'layoutFrontOffice.html.twig' %}


{% block title %}Evenement index{% endblock %}

{% block body %}
<link rel="stylesheet" href="{{ asset('https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.1.0/main.min.css') }}">
<link rel="stylesheet" href="{{ asset('https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.1.0/main.min.css') }}">
<link rel="stylesheet" href="{{ asset('https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@4.1.0/main.min.css') }}">




    <section class="ftco-section">
      <div class="container">
      	<div class="row justify-content-center mb-5 pb-5">
          <div class="col-md-7 text-center heading-section ftco-animate">
            <h2 class="mb-3">evenements</h2>
          </div>
        </div>
        <div class="row">
        {% for evenement in evenements %}
        	<div class="col-lg-3 col-md-6 d-flex mb-sm-4 ftco-animate">
        		<div class="staff">
      				<div class="img mb-4" style="background-image: url({{ asset(evenement.image) }});"></div>
      				<div class="info text-center">
      					<h3><a href="teacher-single.html">{{ evenement.nom }}</a></h3>
      					<span class="position">{{ evenement.descriptif }}</span>
                        <span class="position">{{ evenement.participations | length }} participants</span>
      					<div class="text">
	        				<p>{% set userParticipations = evenement.participations|filter(participation => participation.membre.idUser == 1) %}

                            {% if userParticipations is not empty %}
                                            <td> <a href="{{ path('app_evenement_annuler_reservation', {'idEvenement': evenement.idEvenement , 'idUser' : 1 }) }}">annuler reservation</a></td>
                            {% else %}
                                        <td> <a href="{{ path('app_evenement_participer', {'idEvenement': evenement.idEvenement , 'idUser' : 1 }) }}">reserver</a></td>
                            {% endif %}
                            </p>
	        				
	        			</div>
      				</div>
        		</div>
        	</div>
            {% endfor %}
            </div>
            </div>
        	
        	
        	
        	
        	
        </div>
      </div>
    </section>

    <section class="ftco-section">
      <div class="container">
      	<div class="row justify-content-center mb-5 pb-5">
          <div class="col-md-7 text-center heading-section ftco-animate">
            <h2 class="mb-3">mes participations</h2>
          </div>
        </div>
        <div class="row">
        
        {% for participation in participations %}
        	<div class="col-lg-3 col-md-6 d-flex mb-sm-4 ftco-animate">
        		<div class="staff">
      				<div class="img mb-4" style="background-image: url({{ asset(participation.evenement.image) }});"></div>
      				<div class="info text-center">
      					<h3><a href="teacher-single.html">{{ participation.evenement.nom }}</a></h3>
      					<span class="position">{{ participation.evenement.descriptif }}</span>
                        <span class="position">{{ participation.evenement.participations | length }} participants</span>
      					<div class="text">
	        				<p>{% set userParticipations = participation.evenement.participations|filter(participation => participation.membre.idUser == 1) %}

                            {% if userParticipations is not empty %}
                                            <td> <a href="{{ path('app_evenement_annuler_reservation', {'idEvenement': participation.evenement.idEvenement , 'idUser' : 1 }) }}">annuler reservation</a></td>
                            {% else %}
                                        <td> <a href="{{ path('app_evenement_participer', {'idEvenement': participation.evenement.idEvenement , 'idUser' : 1 }) }}">reserver</a></td>
                            {% endif %}
                            </p>
	        				
	        			</div>
      				</div>
        		</div>
        	</div>
            {% endfor %}
            </div>
            </div>
        	
        	
        	
        	
        	
        </div>
      </div>
    </section>


    <div class="card-body p-0">
                    <div id="calendar-holder"></div>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.1.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@4.1.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.1.0/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@4.1.0/main.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            var calendarEl = document.getElementById('calendar-holder');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                defaultView: 'dayGridMonth',
                editable: true,
                eventSources: [
                    {
                        url: "/evenement/calendar/loadEvents", // Updated URL path
                        method: "POST",
                        extraParams: {
                            filters: JSON.stringify({})
                        },
                        failure: () => {
                            //
                            //
                            alert("There was an error while fetching FullCalendar!");
                        },
                    },
                ],
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay',
                },
                plugins: ['interaction', 'dayGrid', 'timeGrid'], // https://fullcalendar.io/docs/plugin-index
                timeZone: 'UTC',
            });
            calendar.render();
            console.log(calendar);
        });

    </script>
{% endblock %}
